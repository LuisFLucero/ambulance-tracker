<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Ambulance Tracker</title>

  <!-- Leaflet core CSS (for both client & ambulance) -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css">
  <!-- Routing machine CSS (ambulance uses it but harmless globally) -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine/dist/leaflet-routing-machine.css">

  <style>
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
    }
    #map {
      height: 80vh; /* adjust as you like */
      width: 100%;
    }
  </style>

  {% if 'client' in request.path %}
    <link rel="manifest" href="{{ url_for('static', filename='client/manifest.json') }}">
    <script>
      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('/client/sw.js');
      }
    </script>
  {% elif 'ambulance' in request.path %}
    <link rel="manifest" href="{{ url_for('static', filename='ambulance/manifest.json') }}">
    <script>
      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('/ambulance/sw.js');
      }
    </script>
  {% endif %}
</head>
<body>
  <header>
    <h1>ðŸš‘ Ambulance Tracker</h1>
    {% if current_user.is_authenticated %}
      <a href="{{ url_for('logout') }}">Logout</a>
    {% endif %}
  </header>
  <main>
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <ul>
          {% for category, message in messages %}
            <li><strong>{{ category }}</strong>: {{ message }}</li>
          {% endfor %}
        </ul>
      {% endif %}
    {% endwith %}

    {% block content %}{% endblock %}
  </main>

  <!-- Leaflet JS included at bottom so itâ€™s loaded for child scripts -->
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <!-- Routing machine JS, only used if child script calls it -->
  <script src="https://unpkg.com/leaflet-routing-machine/dist/leaflet-routing-machine.js"></script>

  {% block scripts %}{% endblock %}
</body>
</html>
